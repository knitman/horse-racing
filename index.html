<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8" />
<title>PHOTO FINISH ‚Äì Arcade Horses</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
<style>
body{margin:0;background:#101018;color:white;text-align:center;font-family:Arial;}
</style>
</head>
<body>

<h1 style="margin:10px;letter-spacing:4px;">üèÅ PHOTO FINISH üèÅ</h1>
<h3>SPACE = ŒñŒ¨œÅŒπ | R = Restart</h3>
<h3 id="msg"></h3>

<script>
class GameScene extends Phaser.Scene {
    constructor(){ super("game"); }

    preload(){
        this.load.image('horse','horse.png');
    }

    create(){
        this.cameras.main.setBackgroundColor('#0e0e1a');

        this.startX = 160;
        this.finishX = 980;

        // ---------- LANES ----------
        this.lanesY = [];
        for(let i=0;i<6;i++){
            let y = 190 + i*70;
            this.lanesY.push(y);

            let lane = this.add.graphics();
            lane.fillStyle(0x7a4b20);
            lane.fillRect(120, y-30, 900, 60);

            lane.lineStyle(2, 0x4d2f12);
            lane.strokeRect(120, y-30, 900, 60);

            this.add.text(70, y-14, (i+1).toString(), {font:'22px Arial', fill:'#fff'});
        }

        // finish line
        let finish = this.add.graphics();
        finish.fillStyle(0xff2222);
        finish.fillRect(this.finishX, 150, 12, 460);

        // ---------- HORSES ----------
        this.horses = [];
        for(let i=0;i<6;i++){
            let horse = this.add.image(this.startX, this.lanesY[i], 'horse')
                .setScale(0.13);

            // œÉœâœÉœÑœå œáœÅœâŒºŒ¨œÑŒπœÉŒºŒ± œáœâœÅŒØœÇ ŒΩŒ± œáŒ±ŒªŒ¨ŒµŒπ Œ∑ Œ¥ŒπŒ±œÜŒ¨ŒΩŒµŒπŒ±
            horse.setBlendMode(Phaser.BlendModes.MULTIPLY);
            let color = Phaser.Display.Color.HSLToColor(i/6,0.8,0.5).color;
            horse.setTintFill(color);

            horse.posX = this.startX;
            this.horses.push(horse);
        }

        // ---------- DICE ----------
        this.diceBox = this.add.graphics();
        this.diceBox.fillStyle(0xffffff);
        this.diceBox.fillRoundedRect(520,50,90,90,12);

        this.diceDots = this.add.graphics();

        this.winner = null;

        this.input.keyboard.on('keydown-SPACE', ()=> this.rollDice());
        this.input.keyboard.on('keydown-R', ()=> this.resetGame());
    }

    drawDice(value){
        this.diceDots.clear();
        this.diceDots.fillStyle(0x000000);

        const cx = 565, cy = 95;
        const d = 14;

        const dots = {
            1: [[0,0]],
            2: [[-d,-d],[d,d]],
            3: [[-d,-d],[0,0],[d,d]],
            4: [[-d,-d],[d,-d],[-d,d],[d,d]],
            5: [[-d,-d],[d,-d],[0,0],[-d,d],[d,d]],
            6: [[-d,-d],[d,-d],[-d,0],[d,0],[-d,d],[d,d]]
        };

        dots[value].forEach(p=>{
            this.diceDots.fillCircle(cx+p[0], cy+p[1], 6);
        });
    }

    gallopAnimation(horse){
        this.tweens.add({
            targets: horse,
            y: horse.y - 8,
            scaleY: 0.12,
            yoyo: true,
            repeat: 3,
            duration: 90,
            ease: 'Sine.easeInOut'
        });
    }

    rollDice(){
        if(this.winner) return;

        let dice = Phaser.Math.Between(1,6);
        this.drawDice(dice);

        let horse = this.horses[dice-1];
        horse.posX += 95;

        this.tweens.add({
            targets: horse,
            x: horse.posX,
            duration: 500,
            ease: 'Sine.easeInOut'
        });

        this.gallopAnimation(horse);

        if(horse.posX >= this.finishX){
            this.winner = dice;
            document.getElementById("msg").innerText =
                "üèÜ ŒùŒØŒ∫Œ∑œÉŒµ œÑŒø ŒÜŒªŒøŒ≥Œø " + dice + " !";
        }
    }

    resetGame(){
        this.horses.forEach((h,i)=>{
            h.posX = this.startX;
            h.x = this.startX;
            h.y = this.lanesY[i];
        });
        this.diceDots.clear();
        this.winner = null;
        document.getElementById("msg").innerText="";
    }
}

new Phaser.Game({
    type: Phaser.AUTO,
    width:1200,
    height:720,
    scene: GameScene
});
</script>

</body>
</html>
